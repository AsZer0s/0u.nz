<!doctype html><html><head><meta charset="utf-8"><title>htaccess文件格式</title><style>:root{--bg:#111315;--fg:#d6d6d6;--muted:#8b8b8b;--link:#8fa3ad;--link-hover:#c0d2db;--border:#2a2d30;--code-bg:#1a1d1f;--code-border:#2d3135}body{max-width:640px;margin:48px auto;padding:0 16px;background:var(--bg);color:var(--fg);font-family:'Noto Sans SC',system-ui,-apple-system,BlinkMacSystemFont;line-height:1.7}h1{font-size:1.2rem;font-weight:500;margin-bottom:12px}h2{font-size:1.1rem;font-weight:500;margin:2rem 0 1rem;color:var(--fg)}h3{font-size:1rem;font-weight:500;margin:1.5rem 0 0.75rem}.site-header{display:flex;align-items:center;gap:12px;margin-bottom:8px}.site-logo{height:10px;width:auto;display:block}nav{margin-bottom:32px;font-size:0.9rem}nav a{color:var(--muted);text-decoration:none;margin-right:12px}nav a:hover{color:var(--fg)}ul{list-style:none;padding:0;margin:0}li{margin:0.8rem 0}li a{color:var(--link);font-size:0.95rem;text-decoration:none}li a:hover{color:var(--link-hover)}.post-date{color:var(--muted);font-size:0.9rem}p{margin:1em 0}code{background:var(--code-bg);border:1px solid var(--code-border);border-radius:4px;padding:2px 6px;font-family:'Consolas','Monaco','Courier New',monospace;font-size:0.9em;color:#e6e6e6}pre{background:var(--code-bg);border:1px solid var(--code-border);border-radius:6px;padding:16px;overflow-x:auto;margin:1.5em 0}pre::-webkit-scrollbar{height:6px}pre::-webkit-scrollbar-track{background:var(--code-bg)}pre::-webkit-scrollbar-thumb{background:var(--code-border);border-radius:3px}pre::-webkit-scrollbar-thumb:hover{background:var(--muted)}pre code{background:none;border:none;padding:0;font-size:0.875em;line-height:1.6}blockquote{border-left:3px solid var(--border);padding-left:1em;margin:1.5em 0;color:var(--muted);font-style:italic}a{color:var(--link);text-decoration:none}a:hover{color:var(--link-hover)}img{max-width:100%;height:auto;border-radius:4px;margin:1.5em 0}hr{border:none;border-top:1px solid var(--border);margin:2rem 0}table{width:100%;border-collapse:collapse;margin:1.5em 0}th,td{border:1px solid var(--border);padding:8px 12px;text-align:left}th{background:var(--code-bg);font-weight:500}article ul,article ol{list-style:initial;padding-left:2em;margin:1em 0}article li{margin:0.5em 0}footer{margin-top:3rem;padding-top:2rem;border-top:1px solid var(--border);text-align:center}.footer-logo{height:32px;width:auto;display:inline-block;opacity:0.6;transition:opacity 0.3s}.footer-logo:hover{opacity:1}</style><style> .post-meta{display:flex;align-items:center;gap:10px;font-size:13px;color:var(--muted);margin-bottom:24px;flex-wrap:wrap;}.post-tags{display:flex;gap:8px;flex-wrap:wrap;}.tag{font-size:12px;color:var(--muted);text-decoration:none;}.tag::before{content:"#";opacity:.4;}.tag:hover{color:var(--fg);} </style><script> MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']], processEscapes: true, processEnvironments: true }, options: { skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre'] } }; </script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet"></head><body><p><a href="/">← index</a></p><h1>htaccess文件格式</h1><div class="post-meta"><span>2025-04-29</span><div class="post-tags"><a class="tag" href="/tags/开发">开发</a><a class="tag" href="/tags/Linux">Linux</a><a class="tag" href="/tags/前端">前端</a><a class="tag" href="/tags/网络">网络</a></div></div><article><p><img alt="htaccess" src="https://dimg04.tripcdn.com/images/0Z013224x8xro6e4w4B66.jpg" /></p><h2>htaccess文件简介</h2><p>htaccess文件是Apache服务器中的一个配置文件，负责相关目录下的网页配置<br> /www/html下的.htaccess文件与主配置文件中段中内容完全等效<br> .htaccess文件中的配置指令作用于.htaccess文件所在的目录及其所有子目录<br> 且子目录中的指令会覆盖父目录或者主配置文件中的指令</p><h2>rewrite的语法格式：</h2><ol><li>RewriteEngine On #启用rewrite起作用。</li><li>RewriteBase url-path #设定基准目录。</li><li>RewriteCond test-string condPattern #用于测试rewrite的匹配条件。</li><li>RewriteRule Pattern Substitution #规则</li></ol><h3>RewriteEngine On|Off</h3><p>RewriteEngine 用于开启或停用rewrite功能。rewrite configurations 不会自动继承</p><h3>RewriteBase URL-path</h3><p>RewriteBase用于设定重写的基准URL<br> RewriteRule可以用于目录级的配置文件中 (.htaccess)并在局部范围内起作用<br> 即规则实际处理的只是剥离了本地路径前缀的一部分<br> 处理结束后，这个路径会被自动地附着回去<br> 默认值是”RewriteBase physical-directory-path”</p><h3>RewriteCond TestString CondPattern [flags]</h3><p>RewriteCond指令定义了一个规则的条件，即，在一个RewriteRule指令之前有一个或多个RewriteCond指令<br> 条件之后的重写规则仅在当前URI与pattern匹配并且符合这些条件的时候才会起作用<br> TestString是一个纯文本的字符串<br> 但是还可以包含下列可扩展的成分:</p><pre><code class="language-apache">+RewriteRule反向引用: 引用方法是 $N (0 &lt;= N &lt;= 9) 引用当前(带有若干RewriteCond指令的)RewriteRule中的与pattern匹配的分组成分(圆括号!) +RewriteCond反向引用: 引用方法是 %N (1 &lt;= N &lt;= 9) 引用当前若干RewriteCond条件中最后符合的条件中的分组成分(圆括号!) +RewriteMap 扩展: 引用方法是 ${mapname:key|default} + 服务器变量: 引用方法是 %{ NAME_OF_VARIABLE } CondPattern是条件参数 Flags标识是是第三个参数,可选OR、AND、NC，默认为AND </code></pre><h3>RewriteRule Pattern Substitution [Flags]</h3><p>其中的Pattern就是参数，一般为一些文件的扩展名<br> Substitution是用来替换前面用的，这儿的Flags<br> 常用的R表示 redirect（强制重定向），F表示forbidden（禁止访问），L表示last（最后）<br> 通常当你希望停止重写操作而立即重定向时，可用它</p><h2>.htaccess文件URL重写写法例子</h2><h3>1. 反盗链</h3><pre><code class="language-apache">RewriteBase / RewriteCond %{HTTP_REFERER} !^$ RewriteCond %{HTTP_REFERER} !^http://(www.)?yoursite.com/.*$ [NC] RewriteRule .(gif|jpg|swf|flv|png)$ /feed/ [R=302,L] </code></pre><h3>2. 防止目录浏览</h3><pre><code class="language-apache">Options All -Indexes </code></pre><h3>3. SEO友好的301永久重定向</h3><pre><code class="language-apache">Redirect 301 http://www.yoursite.com/article.html http://www.yoursite.com/archives/article </code></pre><h3>4. 显示个性化的 404 错误页面</h3><pre><code class="language-apache">ErrorDocument 404 /404.html </code></pre><h3>5. 设置目录的默认页面</h3><p>假如你需要为不同的目录设置不同的默认页面，你可以很容易的通过 .htaccess 实现：</p><pre><code class="language-apache">DirectoryIndex about.html </code></pre><h3>6. 基于referer来限制网站访问</h3><pre><code class="language-apache">&lt;IfModule mod_rewrite.c&gt; RewriteEngine on RewriteCond %{HTTP_REFERER} spamteam.com [NC,OR] RewriteCond %{HTTP_REFERER} trollteam.com [NC,OR] RewriteRule .* – [F] &lt;/ifModule&gt; </code></pre><h3>7. 限制PHP上传文件大小</h3><pre><code class="language-apache">php_value upload_max_filesize 20M php_value post_max_size 20M php_value max_execution_time 200 php_value max_input_time 200 </code></pre><h3>8. 通过压缩文件来减少网络流量</h3><pre><code class="language-apache">AddOutputFilterByType DEFLATE text/plain AddOutputFilterByType DEFLATE text/html AddOutputFilterByType DEFLATE text/xml AddOutputFilterByType DEFLATE text/css AddOutputFilterByType DEFLATE application/xml AddOutputFilterByType DEFLATE application/xhtml+xml AddOutputFilterByType DEFLATE application/rss+xml AddOutputFilterByType DEFLATE application/javascript AddOutputFilterByType DEFLATE application/x-javascript </code></pre><h3>9. 缓存文件</h3><pre><code class="language-apache">&lt;FilesMatch “.(flv|gif|jpg|jpeg|png|ico|swf|js|css|pdf)$”&gt; Header set Cache-Control “max-age=2592000〃 &lt;/FilesMatch&gt; </code></pre><h3>10. 添加尾部的反斜杠</h3><pre><code class="language-apache">&lt;IfModule mod_rewrite.c&gt; RewriteCond %{REQUEST_URI} /+[^\.]+$ RewriteRule ^(.+[^/])$ %{REQUEST_URI}/ [R=301,L] &lt;/IfModule&gt; </code></pre><h3>11. 处理移动过的文件</h3><pre><code class="language-apache">Redirect 301 /old.html http://yoursite.com/new.html </code></pre><p>或者是</p><pre><code class="language-apache">RewriteRule /old.html http://yoursite.com/new.html [R=301,L] </code></pre><p>如果想隐式跳转</p><pre><code class="language-apache">RewriteRule /old.html http://yoursite.com/new.html [L] </code></pre><h3>12. html后缀的url链接到php文件</h3><pre><code class="language-apache">RewriteRule ^/?([a-z/]+)\.html$ $1.php [L] </code></pre><h3>13. 旧文件夹的内容链接到新文件夹</h3><pre><code class="language-apache">RewriteRule ^/?old_directory/([a-z/.]+)$ new_directory/$1 [R=301,L] </code></pre><h3>14. 隐藏文件名</h3><pre><code class="language-apache">RewriteRule ^/?([a-z]+)$ $1.php [L] </code></pre><h3>15. 阻止/允许特定IP/IP段</h3><p>禁止所有IP，除了指定的</p><pre><code class="language-apache">order deny,allow deny from all </code></pre><p>如果想允许IP段，如123.123.123.0 ~ 123.123.123.255，则</p><pre><code class="language-apache">allow from 123.123.123. allow from 123.123.123.123 ErrorDocument 403 /page.html &lt;Files page.html&gt; allow from all &lt;/Files&gt; </code></pre><p>如果想禁止特定IP</p><pre><code class="language-apache">deny from 123.123.123.123 </code></pre><h3>16. 添加MIME类型</h3><pre><code class="language-apache">AddType video/x-flv .flv </code></pre><p>如果设置类型为 application/octet-stream 将提示下载</p><pre><code class="language-apache">AddType application/octet-stream .pdf </code></pre></article><hr><p><a href="/">← index</a></p><footer><img src="/0unz.png" alt="0u logo" class="footer-logo"></footer></body></html>