<!doctype html><html><head><meta charset="utf-8"><title>ArchLinux基础安装</title><style>:root{--bg:#111315;--fg:#d6d6d6;--muted:#8b8b8b;--link:#8fa3ad;--link-hover:#c0d2db;--border:#2a2d30;--code-bg:#1a1d1f;--code-border:#2d3135}body{max-width:640px;margin:48px auto;padding:0 16px;background:var(--bg);color:var(--fg);font-family:'Noto Sans SC',system-ui,-apple-system,BlinkMacSystemFont;line-height:1.7}h1{font-size:1.2rem;font-weight:500;margin-bottom:12px}h2{font-size:1.1rem;font-weight:500;margin:2rem 0 1rem;color:var(--fg)}h3{font-size:1rem;font-weight:500;margin:1.5rem 0 0.75rem}.site-header{display:flex;align-items:center;gap:12px;margin-bottom:8px}.site-logo{height:10px;width:auto;display:block}nav{margin-bottom:32px;font-size:0.9rem}nav a{color:var(--muted);text-decoration:none;margin-right:12px}nav a:hover{color:var(--fg)}ul{list-style:none;padding:0;margin:0}li{margin:0.8rem 0}li a{color:var(--link);font-size:0.95rem;text-decoration:none}li a:hover{color:var(--link-hover)}.post-date{color:var(--muted);font-size:0.9rem}p{margin:1em 0}code{background:var(--code-bg);border:1px solid var(--code-border);border-radius:4px;padding:2px 6px;font-family:'Consolas','Monaco','Courier New',monospace;font-size:0.9em;color:#e6e6e6}pre{background:var(--code-bg);border:1px solid var(--code-border);border-radius:6px;padding:16px;overflow-x:auto;margin:1.5em 0}pre::-webkit-scrollbar{height:6px}pre::-webkit-scrollbar-track{background:var(--code-bg)}pre::-webkit-scrollbar-thumb{background:var(--code-border);border-radius:3px}pre::-webkit-scrollbar-thumb:hover{background:var(--muted)}pre code{background:none;border:none;padding:0;font-size:0.875em;line-height:1.6}blockquote{border-left:3px solid var(--border);padding-left:1em;margin:1.5em 0;color:var(--muted);font-style:italic}a{color:var(--link);text-decoration:none}a:hover{color:var(--link-hover)}img{max-width:100%;height:auto;border-radius:4px;margin:1.5em 0}hr{border:none;border-top:1px solid var(--border);margin:2rem 0}table{width:100%;border-collapse:collapse;margin:1.5em 0}th,td{border:1px solid var(--border);padding:8px 12px;text-align:left}th{background:var(--code-bg);font-weight:500}article ul,article ol{list-style:initial;padding-left:2em;margin:1em 0}article li{margin:0.5em 0}footer{margin-top:3rem;padding-top:2rem;border-top:1px solid var(--border);text-align:center}.footer-logo{height:32px;width:auto;display:inline-block;opacity:0.6;transition:opacity 0.3s}.footer-logo:hover{opacity:1}</style><style> .post-meta{display:flex;align-items:center;gap:10px;font-size:13px;color:var(--muted);margin-bottom:24px;flex-wrap:wrap;}.post-tags{display:flex;gap:8px;flex-wrap:wrap;}.tag{font-size:12px;color:var(--muted);text-decoration:none;}.tag::before{content:"#";opacity:.4;}.tag:hover{color:var(--fg);} </style><script> MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']], processEscapes: true, processEnvironments: true }, options: { skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre'] } }; </script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet"></head><body><p><a href="/">← index</a></p><h1>ArchLinux基础安装</h1><div class="post-meta"><span>2024-11-19</span><div class="post-tags"><a class="tag" href="/tags/Linux">Linux</a><a class="tag" href="/tags/杂谈">杂谈</a><a class="tag" href="/tags/开发">开发</a><a class="tag" href="/tags/网络">网络</a></div></div><article><p>本篇参考 <a href="https://wiki.archlinux.org/index.php/Installation_guide" target="_blank" rel="noopener noreferrer">Arch Linux 官方安装指南</a></p><h2>禁用 reflector</h2><p>reflector 会为你选择速度合适的镜像源<br> 但其结果并不准确<br> 同时会清空配置文件中的内容<br> 对于新人来讲并不适用<br> 我们首先对其进行禁用</p><pre><code class="language-bash">systemctl stop reflector.service </code></pre><h2>再次确保是否为 UEFI 模式</h2><p>在一系列的信息刷屏后<br> 可以看到已经以 root 登陆安装系统了<br> 此时可以执行的命令</p><pre><code class="language-bash">ls /sys/firmware/efi/efivars </code></pre><p>若输出了一堆东西，即 <code>efi</code> 变量<br> 则说明已在 <code>UEFI</code> 模式<br> 否则请确认你的启动方式是否为 <code>UEFI</code></p><h2>连接网络</h2><p>一般来说，你连接的网络几乎均可以通过 <code>DHCP</code> 的方式来进行 <code>IP 地址</code> 和 <code>DNS</code> 的相关设置<br> 在没有合适网络的情况下，使用 <code>手机的移动热点</code> 也是很方便的选择<br> 如果你的网络环境需要配置静态 <code>IP</code> 和 <code>DNS</code><br> 请自行参考 <a href="https://wiki.archlinux.org/title/Installation_guide#Connect_to_the_internet" target="_blank" rel="noopener noreferrer">Arch Wiki</a></p><p>对于有线连接来说，直接插入网线即可</p><p>对于无线连接，则需进行如下操作进行网络连接</p><p>无线连接使用 iwctl 命令进行，按照如下步骤进行网络连接</p><pre><code class="language-bash">iwctl #执行iwctl命令，进入交互式命令行 device list #列出设备名，比如无线网卡看到叫 wlan0 station wlan0 scan #扫描网络 station wlan0 get-networks #列出网络 比如想连接YOUR-WIRELESS-NAME这个无线 station wlan0 connect YOUR-WIRELESS-NAME #进行连接 输入密码即可 exit #成功后exit退出 </code></pre><p>可以等待几秒等网络建立链接后再进行下面测试网络的操作</p><pre><code class="language-bash">ping www.gnu.org </code></pre><hr /><p>如果你不能正常连接网络，首先确认系统已经启用网络接口<a href="https://wiki.archlinux.org/index.php/Network_configuration/Wireless#Check_the_driver_status" target="_blank" rel="noopener noreferrer">Ⅰ</a></p><pre><code class="language-bash">ip link #列出网络接口信息，如不能联网的设备叫wlan0 ip link set wlan0 up #比如无线网卡看到叫 wlan0 </code></pre><p>如果随后看到类似 <code>Operation not possible due to RF-kill</code> 的报错，继续尝试 <code>rfkill</code> 命令来解锁无线网卡</p><pre><code class="language-bash">rfkill unblock wifi </code></pre><h2>更新系统时钟</h2><pre><code class="language-bash">timedatectl set-ntp true #将系统时间与网络时间进行同步 timedatectl status #检查服务状态 </code></pre><h2>分区</h2><p>这里总共设置三个分区，是一个我们认为较为通用的方案<br> 此步骤会清除磁盘中全部内容，请事先确认</p><ul><li>EFI 分区 <a href="https://wiki.archlinux.org/title/EFI_system_partition#Mount_the_partition" target="_blank" rel="noopener noreferrer">Ⅱ</a>： /efi 800M</li><li>根目录： / 100G</li><li>用户主目录： /home 剩余全部</li></ul><blockquote><p>这里根目录的大小仅为参考<br> 一般来说个人日常使用的 linux 分配 100G 已经够用了<br> 根目录最小建议不小于 50G，根目录过小会造成无法更新系统软件包等问题</p></blockquote><p>首先将磁盘转换为 gpt 类型<br> 这里假设比如你想安装的磁盘名称为 sdx<br> 如果你使用 NVME 的固态硬盘<br> 你看到的磁盘名称可能为 nvme0n1</p><pre><code class="language-bash">lsblk #显示分区情况 找到你想安装的磁盘名称 parted /dev/sdx #执行parted，进入交互式命令行，进行磁盘类型变更 (parted)mktable #输入mktable New disk label type? gpt #输入gpt 将磁盘类型转换为gpt 如磁盘有数据会警告，输入yes即可 quit #最后quit退出parted命令行交互 </code></pre><p>接下来使用 <code>cfdisk</code> 命令对磁盘分区。进入 <code>cfdisk</code> 后的操作很直观<br> 用键盘的<code>方向键</code> 、 <code>Tab 键</code> 、 <code>回车键</code> 配合即可操作分配各个分区的大小与格式<br> 一般建议将 <code>EFI 分区</code> 设置为磁盘的第一个分区<br> 据说有些主板如果不将 EFI 设置为第一个分区， <code>可能</code> 有 <code>不兼容</code> 的问题<br> 其中 <code>EFI 分区</code> 选择 <code>EFI System</code> 类型<br> 其余两个分区<code>选择</code>Linux filesystem` 类型</p><pre><code class="language-bash">cfdisk /dev/sdx #来执行分区操作,分配各个分区大小，类型 fdisk -l #分区结束后， 复查磁盘情况 </code></pre><h2>格式化</h2><p>建立好分区后，需要对分区用合适的文件系统进行格式化<br> 这里用mkfs.ext4命令格式化根分区与 home 分区<br> 用mkfs.vfat命令格式化 EFI 分区<br> 如下命令中的 sdax 中，x 代表分区的序号<br> 格式化命令要与上一步分区中生成的分区名字对应才可以</p><p>磁盘若事先有数据<br> 会提示你: 'proceed any way?' 按 y 回车继续即可</p><pre><code class="language-bash">mkfs.ext4 /dev/sdax #格式化根目录和home目录的两个分区 mkfs.vfat /dev/sdax #格式化efi分区 </code></pre><h2>挂载</h2><p>在挂载时，挂载是有顺序的，先挂载根分区，再挂载 EFI 分区<br> 这里的 sdax 只是例子，具体根据你自身的实际分区情况来</p><pre><code class="language-bash">mount /dev/sdax /mnt mkdir /mnt/efi #创建efi目录 mount /dev/sdax /mnt/efi mkdir /mnt/home #创建home目录 mount /dev/sdax /mnt/home </code></pre><h2>镜像源的选择</h2><p>使用如下命令编辑镜像列表</p><pre><code class="language-bash">vim /etc/pacman.d/mirrorlist </code></pre><p>其中的首行是将会使用的镜像源<br> 添加中科大或者清华的放在最上面即可</p><pre><code class="language-bash">Server = https://mirrors.ustc.edu.cn/archlinux/$repo/os/$arch Server = https://mirrors.tuna.tsinghua.edu.cn/archlinux/$repo/os/$arch </code></pre><p>如果其速度不佳，可以手动指定其他镜像源。完整的镜像源列表可参考<a href="https://archlinux.org/mirrorlist/" target="_blank" rel="noopener noreferrer">镜像源生成器</a></p><p>这里使用中国境内的镜像源以提高访问速度</p><blockquote><p>然而这存在问题，镜像源(如 <code>ArchLinux 清华镜像源</code> )以及第三方源(如 <code>ArchLinuxCN</code> )可以知道你的 <code>IP</code> 是什么<br> 什么时候更新了系统，什么时候检查了系统，什么时候更新了什么软件，你安装的软件列表是什么<br> 在 <code>威权国家</code> 的 <code>镜像源维护者</code> 完全有可能 <code>根据威权当局</code> 的要求 <code>提供这些数据</code><br><code>很多维护者</code> 在网络上几乎是 <code>实名上网</code> 的，他们 <code>没有任何抵抗能力</code><br> 进一步的， <code>威权国家</code> 可以根据这些 <code>元数据</code> 与你产生的 <code>其他元数据</code> 进行 <code>比对</code><br> 从而对你进行 <code>进一步</code> 的 <code>定位与辨识</code><br> 简单举一个 <code>例子</code> ，要求维护者 <code>提供</code> 或 <code>监视</code> 安装了 <code>v2ray/qv2ray</code> 等软件包的 <code>使用者</code> 的 <code>IP</code> ,以及 <code>安装时间</code> ，以及其 <code>全部软件列表</code></p><p>如果你在安装 ArchLinux 时的网络已经处于 <code>代理模式</code> 下<br> 可以选择一个 <code>与你代理位置较近</code> 的, <code>非威权国家</code> 的镜像源来使用<br> 如果你在安装 ArchLinux 时的网络环境 <code>没有代理</code><br> 那么在安装结束后，需要 <code>尽快更换</code> 一个 <code>非威权国家</code> 的镜像源来使用<br> 如下列举一些较为优质的 <code>国际源</code></p></blockquote><pre><code class="language-bash">Server = https://mirror.archlinux.tw/ArchLinux/$repo/os/$arch #东亚地区:台湾/中华民国 Server = https://mirror.0xem.ma/arch/$repo/os/$arch #北美洲地区:加拿大 Server = https://mirror.aktkn.sg/archlinux/$repo/os/$arch #东南亚地区:新加坡 Server = https://archlinux.uk.mirror.allworldit.com/archlinux/$repo/os/$arch #欧洲地区:英国 Server = https://mirrors.cat.net/archlinux/$repo/os/$arch #东亚地区:日本 </code></pre><h2>安装系统</h2><p>必须的基础包</p><pre><code class="language-bash">pacstrap /mnt base base-devel linux linux-headers linux-firmware #base-devel在AUR包的安装是必须的 </code></pre><p>注意<br> 目前需要首先确保等待 <code>pacman-init.service</code> 服务启动后，才能执行 <code>pacstrap</code> 或 <code>pacman</code> 命令安装包<br> 否则会 <code>引发错误</code> 使得安装过程无法进行<br> 使用 <code>systemctl status pacman-init.service</code> 命令来检查当前服务状态<br> 更多内容参考 bbs 中的 <a href="https://bbs.archlinux.org/viewtopic.php?id=278518&amp;p=2" target="_blank" rel="noopener noreferrer">帖子</a></p><p>若安装时出现密钥环相关错误，参考此文章 <a href="https://archlinux.org/news/gnupg-21-and-the-pacman-keyring/" target="_blank" rel="noopener noreferrer">GnuPG-2.1 and the pacman keyring</a> 并执行其中的命令</p><p>必须的功能性软件</p><pre><code class="language-bash">pacstrap /mnt dhcpcd iwd vim bash-completion #一个有线所需(iwd也需要dhcpcd) 一个无线所需 一个编辑器 一个补全工具 </code></pre><h2>生成 fstab 文件</h2><p>fstab 用来定义磁盘分区</p><pre><code class="language-bash">genfstab -U /mnt &gt;&gt; /mnt/etc/fstab </code></pre><p>复查一下 /mnt/etc/fstab 确保没有错误</p><pre><code class="language-bash">cat /mnt/etc/fstab </code></pre><h2>Change root</h2><p>把环境切换到 <code>新系统</code>的 <code>/mnt</code> 下</p><pre><code class="language-bash">arch-chroot /mnt </code></pre><h2>时区设置</h2><p>设置时区，在 <code>/etc/localtime</code> 下用 <code>/usr</code> 中合适的时区创建符号连接<br> 如下设置 <code>上海时区</code></p><pre><code class="language-bash">ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime </code></pre><p>随后进行硬件时间设置，将当前的正确 UTC 时间写入硬件时间</p><pre><code class="language-bash">hwclock --systohc </code></pre><h2>设置 Locale 进行本地化</h2><p>Locale 决定了 <code>地域</code> 、 <code>货币</code> 、 <code>时区日期的格式</code> 、 <code>字符排列方式</code> 和其他本地化标准</p><p>首先使用 <code>vim</code> 编辑 <code>/etc/locale.gen</code> ，去掉 <code>en_US.UTF-8</code> 所在行以及 <code>zh_CN.UTF-8</code> 所在行的注释符号 <code>#</code></p><pre><code class="language-bash">vim /etc/locale.gen </code></pre><p>然后使用如下命令生成 locale</p><pre><code class="language-bash">locale-gen </code></pre><p>最后向 <code>/etc/locale.conf</code> 导入内容</p><pre><code class="language-bash">echo 'LANG=en_US.UTF-8' &gt; /etc/locale.conf </code></pre><h2>设置主机名</h2><p>首先在 <code>/etc/hostname</code> 设置主机名</p><pre><code class="language-bash">vim /etc/hostname </code></pre><p>加入你想为主机取的主机名，这里比如叫 ArchZer0s<br> 接下来在/etc/hosts设置与其匹配的条目</p><pre><code class="language-bash">vim /etc/hosts </code></pre><p>加入如下内容</p><pre><code class="language-bash">127.0.0.1 localhost ::1 localhost 127.0.1.1 ArchZer0s </code></pre><p>某些情况下如不设置主机名<br> 在 <code>KDE</code> 下可能会存在网络情况变更时 <code>无法启动 GUI 应用</code> 的问题<br> 在终端中出现形如 <code>No protocol specified qt.qpa.xcb: could not connect to display</code> 的错误<br> 这种情况较为少见 <a href="https://bbs.archlinux.org/viewtopic.php?id=241338" target="_blank" rel="noopener noreferrer">Ⅲ</a><a href="https://bbs.archlinux.org/viewtopic.php?id=243674" target="_blank" rel="noopener noreferrer">Ⅳ</a><a href="https://wiki.archlinux.org/title/Network_configuration#Local_hostname_resolution" target="_blank" rel="noopener noreferrer">Ⅴ</a></p><h2>为 root 用户设置密码</h2><pre><code class="language-bash">passwd </code></pre><h2>安装微码</h2><pre><code class="language-bash">pacman -S intel-ucode #Intel pacman -S amd-ucode #AMD </code></pre><h2>安装引导程序</h2><pre><code class="language-bash">pacman -S grub efibootmgr #grub是启动引导器，efibootmgr被 grub 脚本用来将启动项写入 NVRAM。 grub-install --target=x86_64-efi --efi-directory=/efi --bootloader-id=GRUB </code></pre><p>接下来编辑 <code>/etc/default/grub</code> 文件<br> 去掉 <code>GRUB_CMDLINE_LINUX_DEFAULT</code> 一行中最后的 <code>quiet</code> 参数<br> 同时把 <code>log level</code> 的数值从 <code>3</code> 改成 <code>5</code><br> 这样是为了后续如果出现系统错误，方便排错<br> 同时在同一行加入 <code>nowatchdog</code> 参数<br> 这可以显著提高开关机速度</p><pre><code class="language-bash">vim /etc/default/grub </code></pre><p>使用 N 卡的用户需要注意<br><code>KDE6</code> 默认使用 <code>wayland session</code> 为默认<br> 如果你需要使用 <code>wayland</code> ,则需开启 <code>DRM</code><br> 同样编辑 <code>/etc/default/grub</code> 文件<br> 在 <code>GRUB_CMDLINE_LINUX_DEFAULT</code> 一行中最后的加入参数 <code>nvidia_drm.modeset=1</code></p><p>最后生成 GRUB 所需的配置文件</p><pre><code class="language-bash">grub-mkconfig -o /boot/grub/grub.cfg </code></pre><blockquote><p>我们在之前的命令中指定了 <code>bootloader-id</code> 为 <code>GRUB</code><br> 这一般不会出现问题<br> 然而在某些主板安装完成后，你会发现 <code>没有 nvme 启动条目</code><br> 这是因为 <code>某些主板</code> 的 <code>UEFI 固件</code> 在显示 <code>UEFI NVRAM</code> 引导条目 <code>之前</code><br> 需要在特定的位置存放可引导文件，<code>不支持自定义</code> 存放 <code>efi 文件</code><a href="https://wiki.archlinux.org/index.php/GRUB#Default/fallback_boot_path" target="_blank" rel="noopener noreferrer">Ⅵ</a><br> 解决方式是使用 <code>--removable</code> 参数解决一些主板 <code>NVRAM</code> 的兼容性问题</p></blockquote><pre><code class="language-bash">grub-install --target=x86_64-efi --efi-directory=/efi --removable grub-mkconfig -o /boot/grub/grub.cfg </code></pre><p>除此之外，如果你的主板是一些较老的型号<br> 如 <code>intel 9</code> 系列以下或者 <code>较老 AMD 的主板</code><br> 它们很可能 <code>不支持</code> 从 nvme 启动系统<br> 虽然可以通过 <code>修改 BIOS</code> 加入 NVME 支持模块来解决<br> 但这不在本文讨论范围内</p><h2>完成安装</h2><pre><code class="language-bash">exit # 退回安装环境# umount -R /mnt # 卸载新分区 reboot # 重启 </code></pre><p>注意，重启前要先拔掉优盘，否则你重启后还是进安装程序而不是安装好的系统<br> 重启后，<code>开启 dhcp 服务</code> ，即可连接网络</p><pre><code class="language-bash">systemctl start dhcpcd #立即启动dhcp ping www.gnu.org #测试网络连接 </code></pre><p>若为无线链接，则还需要启动 <code>iwd</code> 才可以使用 <code>iwctl</code> 连接网络</p><pre><code class="language-bash">systemctl start iwd #立即启动iwd iwctl #和之前的方式一样，连接无线网络 </code></pre><p>到此为止，一个基础的，<code>无 UI 界面</code> 的 <code>Arch Linux</code> 已经安装完成了</p><blockquote><p>ArchLinux 在 <code>2021 年 4 月</code> 在安装镜像中内置了一个安装脚本，提供一些选项，即可快速安装<br> 其和所有一键安装脚本类似，提供自动化，且不灵活的安装过程<br><code>不建议</code> 使用这种安装脚本，除了不灵活的原因，<code>初学者也无法在这种安装过程中学到任何东西</code><br> 如果你因为任何原因需要 <code>快速启动一个基础的 ArchLinux 环境</code> ，那么可以 <code>尝试</code> 此脚本</p></blockquote></article><hr><p><a href="/">← index</a></p><footer><img src="/0unz.png" alt="0u logo" class="footer-logo"></footer></body></html>